{"remainingRequest":"/Users/yxy/work/y3tu/yao/yao-ui/src/main/webapp/node_modules/babel-loader/lib/index.js!/Users/yxy/work/y3tu/yao/yao-ui/src/main/webapp/src/utils/request.js","dependencies":[{"path":"/Users/yxy/work/y3tu/yao/yao-ui/src/main/webapp/src/utils/request.js","mtime":1580564563338},{"path":"/Users/yxy/work/y3tu/yao/yao-ui/src/main/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1578533679077},{"path":"/Users/yxy/work/y3tu/yao/yao-ui/src/main/webapp/node_modules/babel-loader/lib/index.js","mtime":1578533613779}],"contextDependencies":[],"result":["import \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/yxy/work/y3tu/yao/yao-ui/src/main/webapp/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.for-each\";\nimport \"core-js/modules/es6.object.is\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.date.to-string\";\nimport \"core-js/modules/es6.array.index-of\";\nimport axios from 'axios';\nimport { Message } from 'element-ui';\nimport { authorizationValue } from '@/settings';\nimport store from '@/store/index';\nimport { getToken, getRefreshToken, getExpireTime } from '@/utils/auth';\nimport NProgress from 'nprogress';\nimport 'nprogress/nprogress.css'; // 请求超时时间，10s\n\nvar requestTimeOut = 10 * 1000; // 成功状态\n\nvar success = 200; // 更换令牌的时间区间\n\nvar checkRegion = 5 * 60 * 1000; // 提示信息显示时长\n\nvar messageDuration = 5 * 1000; // 系统全局请求对象\n\nvar service = axios.create({\n  baseURL: process.env.VUE_APP_BASE_API,\n  timeout: requestTimeOut,\n  responseType: 'json',\n  validateStatus: function validateStatus(status) {\n    return status === success;\n  }\n}); // 系统令牌刷新请求对象\n\nvar refresh_service = axios.create({\n  baseURL: process.env.VUE_APP_BASE_API,\n  timeout: requestTimeOut,\n  responseType: 'json',\n  validateStatus: function validateStatus(status) {\n    return status === success;\n  }\n}); //请求拦截\n\nservice.interceptors.request.use(function (config) {\n  var _config = config;\n\n  try {\n    var expireTime = getExpireTime();\n\n    if (expireTime) {\n      var left = expireTime - new Date().getTime();\n      var refreshToken = getRefreshToken();\n\n      if (left < checkRegion && refreshToken) {\n        _config = queryRefreshToken(_config, refreshToken);\n      } else {\n        if (getToken()) {\n          _config.headers['Authorization'] = 'bearer ' + getToken();\n        }\n      }\n    }\n  } catch (e) {\n    console.error(e);\n  }\n\n  return _config;\n}, function (error) {\n  console.log(error);\n  return Promise.reject(error);\n}); //响应拦截\n\nservice.interceptors.response.use(function (response) {\n  if (response.data !== undefined && response.data !== null && response.data !== '') {\n    var status = response.data.status;\n\n    if (status !== undefined && status === \"ERROR\") {\n      Message({\n        message: response.data.message,\n        type: 'error',\n        duration: 5 * 1000\n      });\n      throw new Error(response.data.message);\n    }\n\n    if (status !== undefined && status === 'WARN') {\n      Message({\n        message: response.data.message,\n        type: 'warning',\n        duration: 5 * 1000\n      });\n      throw new Error(response.data.message);\n    }\n  }\n\n  return response.data;\n}, function (error) {\n  if (error.response) {\n    if (error.toString().indexOf('Error: timeout') !== -1) {\n      Message({\n        message: '网络请求超时',\n        type: 'error',\n        duration: 5 * 1000\n      });\n      return Promise.reject(error);\n    }\n\n    if (error.toString().indexOf('Error: Network Error') !== -1) {\n      Message({\n        message: '网络请求错误',\n        type: 'error',\n        duration: 5 * 1000\n      });\n      return Promise.reject(error);\n    }\n\n    if (error.toString().indexOf('503') !== -1) {\n      Message({\n        message: '服务暂时不可用，请稍后再试!' || 'Error',\n        type: 'error',\n        duration: 5 * 1000\n      });\n      return Promise.reject(error);\n    }\n\n    var errorMessage = error.response.data === null ? '系统内部异常，请联系网站管理员' : error.response.data.message;\n\n    switch (error.response.status) {\n      case 404:\n        Message({\n          message: '很抱歉，资源未找到',\n          type: 'error',\n          duration: messageDuration\n        });\n        break;\n\n      case 403:\n        Message({\n          message: '很抱歉，您暂无该操作权限',\n          type: 'error',\n          duration: messageDuration\n        });\n        break;\n\n      case 401:\n        Message({\n          message: '很抱歉，您没有权限',\n          type: 'error',\n          duration: messageDuration\n        });\n        break;\n\n      default:\n        Message({\n          message: errorMessage,\n          type: 'error',\n          duration: messageDuration\n        });\n        break;\n    }\n  }\n\n  return Promise.reject(error);\n});\nvar request = {\n  refresh: function refresh(url, params) {\n    params['grant_type'] = 'refresh_token';\n    return refresh_service.post(url, params, {\n      transformRequest: [function (params) {\n        return tansParams(params);\n      }],\n      headers: {\n        'Authorization': authorizationValue\n      }\n    });\n  },\n  login: function login(url, params) {\n    params['grant_type'] = 'password';\n    return service.post(url, params, {\n      transformRequest: [function (params) {\n        return tansParams(params);\n      }],\n      headers: {\n        'Authorization': authorizationValue\n      }\n    });\n  },\n  page: function page(url, params) {\n    return service({\n      url: url,\n      method: 'post',\n      data: params\n    });\n  },\n  post: function post(url, params) {\n    return service.post(url, params, {\n      transformRequest: [function (params) {\n        return tansParams(params);\n      }],\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      }\n    });\n  },\n  postData: function postData(url, params) {\n    return service({\n      url: url,\n      method: 'post',\n      data: params\n    });\n  },\n  putData: function putData(url, params) {\n    return service({\n      url: url,\n      method: 'put',\n      data: params\n    });\n  },\n  put: function put(url, params) {\n    return service.put(url, params, {\n      transformRequest: [function (params) {\n        return tansParams(params);\n      }],\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      }\n    });\n  },\n  get: function get(url, params) {\n    var _params;\n\n    if (Object.is(params, undefined)) {\n      _params = '';\n    } else {\n      _params = '?';\n\n      for (var key in params) {\n        if (params.hasOwnProperty(key) && params[key] !== null) {\n          _params += \"\".concat(key, \"=\").concat(params[key], \"&\");\n        }\n      }\n    }\n\n    return service.get(\"\".concat(url).concat(_params));\n  },\n  delete: function _delete(url, params) {\n    var _params;\n\n    if (Object.is(params, undefined)) {\n      _params = '';\n    } else {\n      _params = '?';\n\n      for (var key in params) {\n        if (params.hasOwnProperty(key) && params[key] !== null) {\n          _params += \"\".concat(key, \"=\").concat(params[key], \"&\");\n        }\n      }\n    }\n\n    return service.delete(\"\".concat(url).concat(_params));\n  },\n  download: function download(url, params, filename) {\n    NProgress.start();\n    return service.post(url, params, {\n      // transformRequest: [(params) => {\n      //     return tansParams(params)\n      // }],\n      responseType: 'blob'\n    }).then(function (response) {\n      //处理返回的文件流\n      var blob = new Blob([response], {\n        type: 'application/zip'\n      });\n\n      if (window.navigator.msSaveOrOpenBlob) {\n        // 兼容IE10\n        navigator.msSaveBlob(blob, filename);\n      } else {\n        // 其他非IE内核支持H5的浏览器\n        var _url = window.URL.createObjectURL(blob);\n\n        var link = document.createElement('a');\n        link.style.display = 'none';\n        link.href = _url;\n        link.setAttribute('download', filename);\n        document.body.appendChild(link);\n        link.click();\n      }\n\n      NProgress.done();\n    }).catch(function (r) {\n      console.error(r);\n      NProgress.done();\n      Message({\n        message: '下载失败',\n        type: 'error',\n        duration: messageDuration\n      });\n    });\n  },\n  upload: function upload(url, params) {\n    return service.post(url, params, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n  }\n};\n\nfunction tansParams(params) {\n  var result = '';\n  Object.keys(params).forEach(function (key) {\n    if (!Object.is(params[key], undefined) && !Object.is(params[key], null)) {\n      result += encodeURIComponent(key) + '=' + encodeURIComponent(params[key]) + '&';\n    }\n  });\n  return result;\n}\n\nfunction queryRefreshToken(_x, _x2) {\n  return _queryRefreshToken.apply(this, arguments);\n}\n\nfunction _queryRefreshToken() {\n  _queryRefreshToken = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee(config, refreshToken) {\n    var result;\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return request.refresh('auth/oauth/token', {\n              refresh_token: refreshToken\n            });\n\n          case 2:\n            result = _context.sent;\n\n            if (result.status === success) {\n              saveData(result.data);\n              config.headers['Authorization'] = 'bearer ' + getToken();\n            }\n\n            return _context.abrupt(\"return\", config);\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _queryRefreshToken.apply(this, arguments);\n}\n\nfunction saveData(data) {\n  store.commit('account/setAccessToken', data.access_token);\n  store.commit('account/setRefreshToken', data.refresh_token);\n  var current = new Date();\n  var expireTime = current.setTime(current.getTime() + 1000 * data.expires_in);\n  store.commit('account/setExpireTime', expireTime);\n}\n\nexport default request;",{"version":3,"sources":["/Users/yxy/work/y3tu/yao/yao-ui/src/main/webapp/src/utils/request.js"],"names":["axios","Message","authorizationValue","store","getToken","getRefreshToken","getExpireTime","NProgress","requestTimeOut","success","checkRegion","messageDuration","service","create","baseURL","process","env","VUE_APP_BASE_API","timeout","responseType","validateStatus","status","refresh_service","interceptors","request","use","config","_config","expireTime","left","Date","getTime","refreshToken","queryRefreshToken","headers","e","console","error","log","Promise","reject","response","data","undefined","message","type","duration","Error","toString","indexOf","errorMessage","refresh","url","params","post","transformRequest","tansParams","login","page","method","postData","putData","put","get","_params","Object","is","key","hasOwnProperty","delete","download","filename","start","then","blob","Blob","window","navigator","msSaveOrOpenBlob","msSaveBlob","URL","createObjectURL","link","document","createElement","style","display","href","setAttribute","body","appendChild","click","done","catch","r","upload","result","keys","forEach","encodeURIComponent","refresh_token","saveData","commit","access_token","current","setTime","expires_in"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport {Message} from 'element-ui'\nimport {authorizationValue} from '@/settings'\nimport store from '@/store/index'\nimport {getToken, getRefreshToken, getExpireTime} from '@/utils/auth'\nimport NProgress from 'nprogress'\nimport 'nprogress/nprogress.css'\n\n// 请求超时时间，10s\nconst requestTimeOut = 10 * 1000;\n// 成功状态\nconst success = 200;\n// 更换令牌的时间区间\nconst checkRegion = 5 * 60 * 1000;\n// 提示信息显示时长\nconst messageDuration = 5 * 1000;\n\n// 系统全局请求对象\nconst service = axios.create({\n    baseURL: process.env.VUE_APP_BASE_API,\n    timeout: requestTimeOut,\n    responseType: 'json',\n    validateStatus(status) {\n        return status === success\n    }\n});\n\n// 系统令牌刷新请求对象\nconst refresh_service = axios.create({\n    baseURL: process.env.VUE_APP_BASE_API,\n    timeout: requestTimeOut,\n    responseType: 'json',\n    validateStatus(status) {\n        return status === success\n    }\n});\n\n//请求拦截\nservice.interceptors.request.use(\n    config => {\n        let _config = config;\n        try {\n            const expireTime = getExpireTime();\n            if (expireTime) {\n                const left = expireTime - new Date().getTime();\n                const refreshToken = getRefreshToken();\n                if (left < checkRegion && refreshToken) {\n                    _config = queryRefreshToken(_config, refreshToken)\n                } else {\n                    if (getToken()) {\n                        _config.headers['Authorization'] = 'bearer ' + getToken()\n                    }\n                }\n            }\n        } catch (e) {\n            console.error(e)\n        }\n        return _config\n    },\n    error => {\n        console.log(error);\n        return Promise.reject(error)\n    }\n);\n\n//响应拦截\nservice.interceptors.response.use(response => {\n    if (response.data !== undefined && response.data !== null && response.data !== '') {\n        let status = response.data.status;\n        if (status !== undefined && status === \"ERROR\") {\n            Message({\n                message: response.data.message,\n                type: 'error',\n                duration: 5 * 1000\n            });\n            throw new Error(response.data.message);\n        }\n\n        if (status !== undefined && status === 'WARN') {\n            Message({\n                message: response.data.message,\n                type: 'warning',\n                duration: 5 * 1000\n            });\n            throw new Error(response.data.message);\n        }\n    }\n    return response.data;\n}, (error) => {\n    if (error.response) {\n\n        if (error.toString().indexOf('Error: timeout') !== -1) {\n            Message({\n                message: '网络请求超时',\n                type: 'error',\n                duration: 5 * 1000\n            });\n            return Promise.reject(error)\n        }\n        if (error.toString().indexOf('Error: Network Error') !== -1) {\n            Message({\n                message: '网络请求错误',\n                type: 'error',\n                duration: 5 * 1000\n            });\n            return Promise.reject(error)\n        }\n\n        if (error.toString().indexOf('503') !== -1) {\n            Message({\n                message: '服务暂时不可用，请稍后再试!' || 'Error',\n                type: 'error',\n                duration: 5 * 1000\n            });\n            return Promise.reject(error)\n        }\n\n        const errorMessage = error.response.data === null ? '系统内部异常，请联系网站管理员' : error.response.data.message;\n        switch (error.response.status) {\n            case 404:\n                Message({\n                    message: '很抱歉，资源未找到',\n                    type: 'error',\n                    duration: messageDuration\n                });\n                break;\n            case 403:\n                Message({\n                    message: '很抱歉，您暂无该操作权限',\n                    type: 'error',\n                    duration: messageDuration\n                });\n                break;\n            case 401:\n                Message({\n                    message: '很抱歉，您没有权限',\n                    type: 'error',\n                    duration: messageDuration\n                });\n                break;\n            default:\n                Message({\n                    message: errorMessage,\n                    type: 'error',\n                    duration: messageDuration\n                });\n                break\n        }\n    }\n    return Promise.reject(error)\n});\n\nconst request = {\n    refresh(url, params) {\n        params['grant_type'] = 'refresh_token';\n        return refresh_service.post(url, params, {\n            transformRequest: [(params) => {\n                return tansParams(params)\n            }],\n            headers: {\n                'Authorization': authorizationValue\n            }\n        })\n    },\n    login(url, params) {\n        params['grant_type'] = 'password';\n        return service.post(url, params, {\n            transformRequest: [(params) => {\n                return tansParams(params)\n            }],\n            headers: {\n                'Authorization': authorizationValue\n            }\n        })\n    },\n    page(url, params) {\n        return service({\n            url: url,\n            method: 'post',\n            data: params\n        })\n    },\n    post(url, params) {\n        return service.post(url, params, {\n            transformRequest: [(params) => {\n                return tansParams(params)\n            }],\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded'\n            }\n        })\n    },\n    postData(url,params){\n        return service({\n            url: url,\n            method: 'post',\n            data: params\n        })\n    },\n    putData(url,params){\n        return service({\n            url: url,\n            method: 'put',\n            data: params\n        })\n    },\n    put(url, params) {\n        return service.put(url, params, {\n            transformRequest: [(params) => {\n                return tansParams(params)\n            }],\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded'\n            }\n        })\n    },\n    get(url, params) {\n        let _params;\n        if (Object.is(params, undefined)) {\n            _params = ''\n        } else {\n            _params = '?';\n            for (const key in params) {\n                if (params.hasOwnProperty(key) && params[key] !== null) {\n                    _params += `${key}=${params[key]}&`\n                }\n            }\n        }\n        return service.get(`${url}${_params}`)\n    },\n    delete(url, params) {\n        let _params;\n        if (Object.is(params, undefined)) {\n            _params = ''\n        } else {\n            _params = '?';\n            for (const key in params) {\n                if (params.hasOwnProperty(key) && params[key] !== null) {\n                    _params += `${key}=${params[key]}&`\n                }\n            }\n        }\n        return service.delete(`${url}${_params}`)\n    },\n    download(url, params, filename) {\n        NProgress.start();\n        return service.post(url, params, {\n            // transformRequest: [(params) => {\n            //     return tansParams(params)\n            // }],\n            responseType: 'blob'\n        }).then((response) => {\n            //处理返回的文件流\n            let blob = new Blob([response], {type: 'application/zip'});\n            if (window.navigator.msSaveOrOpenBlob) {// 兼容IE10\n                navigator.msSaveBlob(blob, filename);\n            } else {// 其他非IE内核支持H5的浏览器\n                let url = window.URL.createObjectURL(blob);\n                let link = document.createElement('a');\n                link.style.display = 'none';\n                link.href = url;\n                link.setAttribute('download', filename);\n                document.body.appendChild(link);\n                link.click()\n            }\n            NProgress.done()\n        }).catch((r) => {\n            console.error(r);\n            NProgress.done();\n            Message({\n                message: '下载失败',\n                type: 'error',\n                duration: messageDuration\n            })\n        })\n    },\n    upload(url, params) {\n        return service.post(url, params, {\n            headers: {\n                'Content-Type': 'multipart/form-data'\n            }\n        })\n    }\n};\n\nfunction tansParams(params) {\n    let result = '';\n    Object.keys(params).forEach((key) => {\n        if (!Object.is(params[key], undefined) && !Object.is(params[key], null)) {\n            result += encodeURIComponent(key) + '=' + encodeURIComponent(params[key]) + '&'\n        }\n    });\n    return result\n}\n\nasync function queryRefreshToken(config, refreshToken) {\n    const result = await request.refresh('auth/oauth/token', {\n        refresh_token: refreshToken\n    });\n    if (result.status === success) {\n        saveData(result.data);\n        config.headers['Authorization'] = 'bearer ' + getToken()\n    }\n    return config\n}\n\nfunction saveData(data) {\n    store.commit('account/setAccessToken', data.access_token);\n    store.commit('account/setRefreshToken', data.refresh_token);\n    const current = new Date();\n    const expireTime = current.setTime(current.getTime() + 1000 * data.expires_in);\n    store.commit('account/setExpireTime', expireTime)\n}\n\nexport default request\n"]}]}