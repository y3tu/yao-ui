{"remainingRequest":"/Users/yxy/work/y3tu/yao/yao-ui/src/main/webapp/node_modules/babel-loader/lib/index.js!/Users/yxy/work/y3tu/yao/yao-ui/src/main/webapp/src/router/index.js","dependencies":[{"path":"/Users/yxy/work/y3tu/yao/yao-ui/src/main/webapp/src/router/index.js","mtime":1580564242225},{"path":"/Users/yxy/work/y3tu/yao/yao-ui/src/main/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1578533679077},{"path":"/Users/yxy/work/y3tu/yao/yao-ui/src/main/webapp/node_modules/babel-loader/lib/index.js","mtime":1578533613779}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.for-each\";\nimport _objectSpread from \"/Users/yxy/work/y3tu/yao/yao-ui/src/main/webapp/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.array.index-of\";\nimport \"core-js/modules/es6.function.name\";\nimport Vue from 'vue';\nimport Router from 'vue-router';\nimport Layout from '@/views/layout';\nimport db from '@/utils/localstorage';\nimport Config from '@/settings';\nimport request from '@/utils/request';\nimport store from '@/store/index';\nimport NProgress from 'nprogress';\nimport 'nprogress/nprogress.css';\nimport { isEmpty, isNotEmpty } from \"@/utils/my-validate\";\nimport { Message } from \"element-ui\";\nVue.use(Router);\nvar constRouter = [{\n  path: '/redirect',\n  component: Layout,\n  hidden: true,\n  children: [{\n    path: '/redirect/:path*',\n    component: function component() {\n      return import('@/views/redirect/index');\n    }\n  }]\n}, {\n  path: '/404',\n  component: function component() {\n    return import('@/views/error-page/404');\n  },\n  hidden: true\n}, {\n  path: '/locking',\n  name: 'locking',\n  component: function component() {\n    return import('@/views/lockscreen/components/locking-page');\n  }\n}, {\n  path: '/login',\n  name: '登录页',\n  component: function component() {\n    return import('@/views/login/index');\n  }\n}, {\n  path: '/',\n  component: Layout,\n  redirect: '/dashboard',\n  children: [{\n    path: 'dashboard',\n    component: function component() {\n      return import('@/views/dashboard/index');\n    },\n    name: 'Dashboard',\n    meta: {\n      title: 'dashboard',\n      icon: 'dashboard',\n      affix: true\n    }\n  }]\n}, {\n  path: '/profile',\n  component: Layout,\n  redirect: '/profile/index',\n  hidden: true,\n  children: [{\n    path: 'index',\n    component: function component() {\n      return import('@/views/profile/index');\n    },\n    name: 'Profile',\n    meta: {\n      title: 'profile',\n      icon: 'user',\n      noCache: true\n    }\n  }]\n}, {\n  path: '/error',\n  component: Layout,\n  redirect: 'noRedirect',\n  name: 'ErrorPages',\n  meta: {\n    title: 'errorPages',\n    icon: '404'\n  },\n  children: [{\n    path: '404',\n    component: function component() {\n      return import('@/views/error-page/404');\n    },\n    name: 'Page404',\n    meta: {\n      title: 'page404',\n      noCache: true\n    }\n  }]\n}];\nvar router = new Router({\n  scrollBehavior: function scrollBehavior() {\n    return {\n      y: 0\n    };\n  },\n  routes: constRouter\n});\nvar whiteList = ['/login']; // 导航守卫，渲染动态路由\n\nrouter.beforeEach(function (to, from, next) {\n  if (to.meta.title) {\n    document.title = to.meta.title + ' - ' + Config.title;\n  }\n\n  NProgress.start();\n\n  if (db.get('locking') === '1' && to.name !== 'locking') {\n    // 判断当前是否是锁定状态\n    next('/locking');\n    return;\n  } else if (db.get('locking') === '0' && to.name === 'locking') {\n    next(false);\n  }\n\n  if (whiteList.indexOf(to.path) !== -1) {\n    //白名单直接放行\n    next();\n  } else {\n    var token = db.get('ACCESS_TOKEN');\n    var user = db.get('USER');\n    var userRouter = db.get('USER_ROUTER');\n\n    if (token.length && user) {\n      if (isEmpty(userRouter)) {\n        request.get(\"upms/resource/getUserRouter/\".concat(user.username)).then(function (res) {\n          var permissions = res.data.permissions;\n          store.commit('account/setPermissions', permissions);\n          var asyncRouter = res.data.routes;\n\n          if (isEmpty(asyncRouter)) {\n            Message.error(\"没有获取到用户的路由信息\");\n            return;\n          }\n\n          db.save('USER_ROUTER', asyncRouter);\n          go(to, next, asyncRouter);\n        });\n      } else if (store.state.account.routes.length === 0) {\n        var asyncRouter = userRouter;\n        go(to, next, asyncRouter);\n      } else {\n        next();\n      }\n    } else {\n      if (to.path === '/login') {\n        next();\n      } else {\n        next('/login');\n      }\n    }\n  }\n});\nrouter.afterEach(function () {\n  NProgress.done();\n});\n\nfunction go(to, next, asyncRouter) {\n  //添加404路由\n  var unFound = {\n    path: '*',\n    redirect: '/404',\n    hidden: true\n  };\n  router.addRoutes([unFound]);\n  asyncRouter = filterAsyncRouter(asyncRouter);\n  store.commit('account/setRoutes', asyncRouter);\n  router.addRoutes(asyncRouter);\n  next(_objectSpread({}, to, {\n    replace: true\n  }));\n}\n\nfunction filterAsyncRouter(routes) {\n  var aRouter = [];\n  routes.forEach(function (route) {\n    var _route$data = route.data,\n        path = _route$data.path,\n        _component = _route$data.component,\n        resourceName = _route$data.resourceName,\n        icon = _route$data.icon,\n        type = _route$data.type,\n        parentId = _route$data.parentId,\n        url = _route$data.url;\n    var children = route.children;\n\n    if (type === -1) {\n      //顶级菜单\n      if (isNotEmpty(children)) {\n        aRouter.push(filterAsyncRouter(children));\n      }\n    } else {\n      if (isNotEmpty(_component)) {\n        var oRouter = {\n          path: path,\n          component: function component() {\n            var componentPath = '';\n\n            if (_component === 'Layout') {\n              return import('@/views/layout');\n            } else if (_component === 'Iframe') {\n              return import('@/views/layout/iFrame');\n            } else {\n              componentPath = _component;\n            }\n\n            return import(\"@/views/\".concat(componentPath, \".vue\"));\n          },\n          name: resourceName,\n          meta: {\n            icon: icon,\n            title: resourceName,\n            url: url\n          },\n          icon: icon,\n          parentId: parentId,\n          children: isEmpty(children) ? [] : filterAsyncRouter(children),\n          redirect: isEmpty(children) ? '' : 'noRedirect'\n        };\n        aRouter.push(oRouter);\n      }\n    }\n  });\n  return aRouter;\n}\n\nexport default router;",{"version":3,"sources":["/Users/yxy/work/y3tu/yao/yao-ui/src/main/webapp/src/router/index.js"],"names":["Vue","Router","Layout","db","Config","request","store","NProgress","isEmpty","isNotEmpty","Message","use","constRouter","path","component","hidden","children","name","redirect","meta","title","icon","affix","noCache","router","scrollBehavior","y","routes","whiteList","beforeEach","to","from","next","document","start","get","indexOf","token","user","userRouter","length","username","then","res","permissions","data","commit","asyncRouter","error","save","go","state","account","afterEach","done","unFound","addRoutes","filterAsyncRouter","replace","aRouter","forEach","route","resourceName","type","parentId","url","push","oRouter","componentPath"],"mappings":"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","sourcesContent":["import Vue from 'vue'\nimport Router from 'vue-router'\nimport Layout from '@/views/layout'\nimport db from '@/utils/localstorage'\nimport Config from '@/settings'\nimport request from '@/utils/request'\nimport store from '@/store/index'\nimport NProgress from 'nprogress'\nimport 'nprogress/nprogress.css'\nimport {isEmpty, isNotEmpty} from \"@/utils/my-validate\";\nimport {Message} from \"element-ui\";\n\nVue.use(Router);\n\nconst constRouter = [\n    {\n        path: '/redirect',\n        component: Layout,\n        hidden: true,\n        children: [\n            {\n                path: '/redirect/:path*',\n                component: () => import('@/views/redirect/index')\n            }\n        ]\n    },\n    {\n        path: '/404',\n        component: () => import('@/views/error-page/404'),\n        hidden: true\n    },\n    {\n        path: '/locking',\n        name: 'locking',\n        component: () => import('@/views/lockscreen/components/locking-page')\n    },\n    {\n        path: '/login',\n        name: '登录页',\n        component: () => import('@/views/login/index')\n    },\n    {\n        path: '/',\n        component: Layout,\n        redirect: '/dashboard',\n        children: [\n            {\n                path: 'dashboard',\n                component: () => import('@/views/dashboard/index'),\n                name: 'Dashboard',\n                meta: {title: 'dashboard', icon: 'dashboard', affix: true}\n            }\n        ]\n    },\n    {\n        path: '/profile',\n        component: Layout,\n        redirect: '/profile/index',\n        hidden: true,\n        children: [\n            {\n                path: 'index',\n                component: () => import('@/views/profile/index'),\n                name: 'Profile',\n                meta: {title: 'profile', icon: 'user', noCache: true}\n            }\n        ]\n    },\n    {\n        path: '/error',\n        component: Layout,\n        redirect: 'noRedirect',\n        name: 'ErrorPages',\n        meta: {\n            title: 'errorPages',\n            icon: '404'\n        },\n        children: [\n            {\n                path: '404',\n                component: () => import('@/views/error-page/404'),\n                name: 'Page404',\n                meta: {title: 'page404', noCache: true}\n            }\n        ]\n    }\n];\n\nconst router = new Router({\n    scrollBehavior: () => ({y: 0}),\n    routes: constRouter\n});\n\nconst whiteList = ['/login'];\n\n// 导航守卫，渲染动态路由\nrouter.beforeEach((to, from, next) => {\n\n    if (to.meta.title) {\n        document.title = to.meta.title + ' - ' + Config.title\n    }\n\n    NProgress.start();\n    if (db.get('locking') === '1' && to.name !== 'locking') {\n        // 判断当前是否是锁定状态\n        next('/locking');\n        return;\n    } else if (db.get('locking') === '0' && to.name === 'locking') {\n        next(false);\n    }\n    if (whiteList.indexOf(to.path) !== -1) {\n        //白名单直接放行\n        next()\n    } else {\n        const token = db.get('ACCESS_TOKEN');\n        const user = db.get('USER');\n        const userRouter = db.get('USER_ROUTER');\n        if (token.length && user) {\n            if (isEmpty(userRouter)) {\n                request.get(`upms/resource/getUserRouter/${user.username}`).then((res) => {\n                    const permissions = res.data.permissions;\n                    store.commit('account/setPermissions', permissions);\n                    let asyncRouter = res.data.routes;\n                    if (isEmpty(asyncRouter)) {\n                        Message.error(\"没有获取到用户的路由信息\");\n                        return;\n                    }\n                    db.save('USER_ROUTER', asyncRouter);\n                    go(to, next, asyncRouter)\n                })\n            } else if (store.state.account.routes.length === 0) {\n                let asyncRouter = userRouter;\n                go(to, next, asyncRouter)\n            } else {\n                next()\n            }\n        } else {\n            if (to.path === '/login') {\n                next()\n            } else {\n                next('/login')\n            }\n        }\n    }\n});\n\nrouter.afterEach(() => {\n    NProgress.done()\n});\n\nfunction go(to, next, asyncRouter) {\n    //添加404路由\n    const unFound = {\n        path: '*',\n        redirect: '/404',\n        hidden: true\n    };\n    router.addRoutes([unFound]);\n    asyncRouter = filterAsyncRouter(asyncRouter);\n    store.commit('account/setRoutes', asyncRouter);\n    router.addRoutes(asyncRouter);\n    next({...to, replace: true})\n}\n\nfunction filterAsyncRouter(routes) {\n    const aRouter = [];\n    routes.forEach(route => {\n        const {path, component, resourceName, icon, type, parentId, url} = route.data;\n        const {children} = route;\n        if (type === -1) {\n            //顶级菜单\n            if (isNotEmpty(children)) {\n                aRouter.push(filterAsyncRouter(children));\n            }\n        } else {\n            if (isNotEmpty(component)) {\n                const oRouter = {\n                    path: path,\n                    component: () => {\n                        let componentPath = '';\n                        if (component === 'Layout') {\n                            return import('@/views/layout')\n                        } else if (component === 'Iframe') {\n                            return import('@/views/layout/iFrame')\n                        } else {\n                            componentPath = component\n                        }\n                        return import(`@/views/${componentPath}.vue`)\n                    },\n                    name: resourceName,\n                    meta: {\n                        icon: icon,\n                        title: resourceName,\n                        url: url\n                    },\n                    icon: icon,\n                    parentId: parentId,\n                    children: isEmpty(children) ? [] : filterAsyncRouter(children),\n                    redirect: isEmpty(children) ? '' : 'noRedirect'\n                };\n                aRouter.push(oRouter)\n            }\n        }\n    });\n    return aRouter\n}\n\nexport default router\n"]}]}