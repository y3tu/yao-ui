(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4337dc96"],{"32c0":function(e,t,r){"use strict";var a=r("f2a3"),n=r.n(a);n.a},c6e7:function(e,t,r){"use strict";r("456d"),r("ac6a"),r("f3e2"),r("96cf");var a=r("3b8d");t["a"]={data:function(){return{pageUrl:"",pageLoading:!1,page:{records:[],total:0,current:1,size:10,orders:[],entity:{},params:{}},time:100}},methods:{findPage:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this,e.next=3,t.findPageInit();case 3:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",new Promise((function(e,r){t.pageLoading=!0,Object.keys(t.page.entity).forEach((function(e){null!=t.page.entity[e]&&""!==t.page.entity[e]||delete t.page.entity[e]})),Object.keys(t.page.params).forEach((function(e){null!=t.page.params[e]&&""!==t.page.params[e]||delete t.page.params[e]})),t.page.records=[],t.$page(t.pageUrl,t.page).then((function(r){t.page=r.data,setTimeout((function(){t.pageLoading=!1}),t.time),e(r)})).catch((function(e){t.pageLoading=!1,r(e)}))})));case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),findPageInit:function(){return!0},pageChange:function(e){this.page.current=e,this.findPage()},sizeChange:function(e){this.page.current=0,this.page.size=e,this.findPage()},sortChange:function(e){var t=e.prop,r=e.order;this.page.orders=[],this.page.orders=[{column:t,asc:"ascending"===r}],this.findPage()},resetPage:function(){this.page.entity={},this.page.params={},this.page.orders=[]}}}},f2a3:function(e,t,r){},f713:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"role"},[r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{xs:24,sm:14}},[r("div",{staticClass:"app-container"},[r("div",{staticClass:"filter-container"},[r("el-input",{staticClass:"filter-item search-item",attrs:{placeholder:e.$t("table.role.roleName")},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.page.entity.roleName,callback:function(t){e.$set(e.page.entity,"roleName",t)},expression:"page.entity.roleName"}}),e._v(" "),r("el-button",{staticClass:"filter-item",attrs:{type:"primary",plain:""},on:{click:e.search}},[e._v("\n                        "+e._s(e.$t("table.search"))+"\n                    ")]),e._v(" "),r("el-button",{staticClass:"filter-item",attrs:{type:"warning",plain:""},on:{click:e.reset}},[e._v("\n                        "+e._s(e.$t("table.reset"))+"\n                    ")]),e._v(" "),r("el-dropdown",{directives:[{name:"has-any-permission",rawName:"v-has-any-permission",value:["role:create","role:delete","role:export"],expression:"['role:create','role:delete','role:export']"}],staticClass:"filter-item",attrs:{trigger:"click"}},[r("el-button",[e._v("\n                            "+e._s(e.$t("table.more"))),r("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-dropdown-item",{directives:[{name:"has-permission",rawName:"v-has-permission",value:["role:create"],expression:"['role:create']"}],nativeOn:{click:function(t){return e.add(t)}}},[e._v(e._s(e.$t("table.add")))]),e._v(" "),r("el-dropdown-item",{directives:[{name:"has-permission",rawName:"v-has-permission",value:["role:delete"],expression:"['role:delete']"}],nativeOn:{click:function(t){return e.batchDelete(t)}}},[e._v(e._s(e.$t("table.delete")))]),e._v(" "),r("el-dropdown-item",{directives:[{name:"has-permission",rawName:"v-has-permission",value:["role:export"],expression:"['role:export']"}],nativeOn:{click:function(t){return e.exportExcel(t)}}},[e._v(e._s(e.$t("table.export")))])],1)],1)],1),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}],key:e.tableKey,ref:"table",staticStyle:{width:"100%"},attrs:{data:e.page.records,border:"",fit:""},on:{"selection-change":e.onSelectChange,"sort-change":e.sortChange}},[r("el-table-column",{attrs:{type:"selection",align:"center",width:"40px"}}),e._v(" "),r("el-table-column",{attrs:{label:e.$t("table.role.roleName"),prop:"roleName","show-overflow-tooltip":!0,align:"center","min-width":"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.roleName))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:e.$t("table.role.remark"),prop:"remark","show-overflow-tooltip":!0,align:"center","min-width":"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.remark))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:e.$t("table.role.createTime"),prop:"create_time","show-overflow-tooltip":!0,align:"center","min-width":"180px",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.createTime))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:e.$t("table.operation"),align:"center",width:"150px","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("i",{directives:[{name:"has-permission",rawName:"v-has-permission",value:["role:update"],expression:"['role:update']"}],staticClass:"el-icon-setting table-operation",staticStyle:{color:"#2db7f5"},on:{click:function(t){return e.edit(a)}}}),e._v(" "),r("i",{directives:[{name:"has-permission",rawName:"v-has-permission",value:["role:delete"],expression:"['role:delete']"}],staticClass:"el-icon-delete table-operation",staticStyle:{color:"#f50"},on:{click:function(t){return e.singleDelete(a)}}}),e._v(" "),r("el-link",{directives:[{name:"has-no-permission",rawName:"v-has-no-permission",value:["role:update","role:delete"],expression:"['role:update','role:delete']"}],staticClass:"no-perm"},[e._v("\n                                "+e._s(e.$t("tips.noPermission"))+"\n                            ")])]}}])})],1),e._v(" "),r("el-pagination",{staticStyle:{"margin-top":"8px"},attrs:{total:e.page.total,"current-page":e.page.current,layout:"total, prev, pager, next, sizes"},on:{"size-change":e.sizeChange,"current-change":e.pageChange}})],1)]),e._v(" "),r("el-col",{attrs:{xs:24,sm:10}},[r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[e._v(e._s(""===e.role.roleId?this.$t("common.add"):this.$t("common.edit")))])]),e._v(" "),r("div",[r("el-form",{ref:"form",attrs:{model:e.role,rules:e.rules,"label-position":"right","label-width":"100px"}},[r("el-form-item",{attrs:{label:e.$t("table.role.roleName"),prop:"roleName"}},[r("el-input",{model:{value:e.role.roleName,callback:function(t){e.$set(e.role,"roleName",t)},expression:"role.roleName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("table.role.defaultRole"),"label-position":"right"}},[r("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.role.defaultRole,callback:function(t){e.$set(e.role,"defaultRole",t)},expression:"role.defaultRole"}})],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("table.role.remark"),prop:"remark"}},[r("el-input",{attrs:{type:"textarea",rows:"3"},model:{value:e.role.remark,callback:function(t){e.$set(e.role,"remark",t)},expression:"role.remark"}})],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("table.role.permission"),prop:"remark"}},[r("el-tree",{ref:"permsTree",attrs:{props:e.treeProps,data:e.permsTree,"check-strictly":!0,"show-checkbox":"",accordion:"","node-key":"id","highlight-current":""}})],1)],1)],1)]),e._v(" "),r("el-card",{staticClass:"box-card"},[r("el-row",[r("el-col",{staticStyle:{"text-align":"right"},attrs:{span:24}},[r("el-button",{attrs:{type:"primary",loading:e.buttonLoading,plain:""},on:{click:e.submit}},[e._v(e._s(""===e.role.roleId?this.$t("common.add"):this.$t("common.edit"))+"\n                        ")])],1)],1)],1)],1)],1)],1)},n=[],s=(r("1c01"),r("58b2"),r("8e6e"),r("d25f"),r("456d"),r("386d"),r("ac6a"),r("f3e2"),r("28a5"),r("bd86")),i=r("c6e7");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){Object(s["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={name:"RoleManage",mixins:[i["a"]],data:function(){var e=this;return{tableKey:0,loading:!1,buttonLoading:!1,list:null,selection:[],total:0,permsTree:[],queryParams:{},sort:{},treeProps:{label:"name",children:"children"},role:this.initRole(),rules:{roleName:[{required:!0,message:this.$t("rules.require"),trigger:"blur"},{min:3,max:10,message:this.$t("rules.range3to10"),trigger:"blur"},{validator:function(t,r,a){e.role.roleId?a():e.$get("upms/role/check/".concat(r)).then((function(t){t.data?a():a(e.$t("rules.roleNameExist"))}))},trigger:"blur"}],remark:{max:50,message:this.$t("rules.noMoreThan50"),trigger:"blur"}}}},created:function(){var e=this;this.$nextTick((function(){e.init()}))},mounted:function(){this.initMenuTree()},methods:{init:function(){this.page.current=1,this.page.orders=[{column:"create_time",asc:!0}],this.findPage()},findPageInit:function(){return this.pageUrl="upms/role/page",!0},search:function(){this.resetForm(),this.init()},initRole:function(){return{roleId:"",roleName:"",defaultRole:!1,remark:""}},initMenuTree:function(){var e=this;this.$get("upms/resource/getResourceTree").then((function(t){e.permsTree=t.data}))},onSelectChange:function(e){this.selection=e},clearSelections:function(){this.$refs.table.clearSelection()},exportExcel:function(){},edit:function(e){this.$refs.form.clearValidate(),this.role=l({},e),this.role.resourceIds?this.$refs.permsTree.setCheckedKeys(this.role.resourceIds.split(",")):this.$refs.permsTree.setCheckedKeys([])},singleDelete:function(e){this.$refs.table.toggleRowSelection(e,!0),this.batchDelete()},batchDelete:function(){var e=this;this.selection.length?this.$confirm(this.$t("tips.confirmDelete"),this.$t("common.tips"),{confirmButtonText:this.$t("common.confirm"),cancelButtonText:this.$t("common.cancel"),type:"warning"}).then((function(){var t=[];e.selection.forEach((function(e){t.push(e.roleId)})),e.delete(t)})).catch((function(){e.clearSelections()})):this.$message({message:this.$t("tips.noDataSelected"),type:"warning"})},delete:function(e){var t=this;this.loading=!0,this.$delete("upms/role/delete/".concat(e)).then((function(){t.$message({message:t.$t("tips.deleteSuccess"),type:"success"}),t.search()}))},submit:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return!1;e.buttonLoading=!0,e.role.roleId?(e.role.resourceIds=e.$refs.permsTree.getCheckedKeys().join(","),e.role.createTime=e.role.modifyTime=null,e.$put("upms/role/update",l({},e.role)).then((function(){e.buttonLoading=!1,e.$message({message:e.$t("tips.updateSuccess"),type:"success"}),e.reset()})).catch((function(t){e.buttonLoading=!1}))):(e.role.resourceIds=e.$refs.permsTree.getCheckedKeys().join(","),e.$post("upms/role/create",l({},e.role)).then((function(){e.buttonLoading=!1,e.$message({message:e.$t("tips.createSuccess"),type:"success"}),e.reset()})).catch((function(t){e.buttonLoading=!1})))}))},add:function(){this.resetForm()},reset:function(){this.resetForm(),this.page.entity={},this.sort={},this.$refs.table.clearSort(),this.search()},resetForm:function(){this.$refs.form.clearValidate(),this.$refs.form.resetFields(),this.role=this.initRole(),this.$refs.permsTree.setCheckedKeys([])}}},u=c,p=(r("32c0"),r("0c7c")),d=Object(p["a"])(u,a,n,!1,null,"0fc4c073",null);t["default"]=d.exports}}]);