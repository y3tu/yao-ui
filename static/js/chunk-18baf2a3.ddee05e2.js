(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-18baf2a3"],{"212d":function(e,t,a){"use strict";a.r(t);var l,r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container",staticStyle:{padding:"8px"}},[a("eForm"),e._v(" "),a("div",{staticClass:"head-container"},[e.crud.props.searchToggle?a("div",[a("label",{staticClass:"el-form-item-label"},[e._v("图表名称")]),e._v(" "),a("el-input",{staticClass:"filter-item",staticStyle:{width:"185px"},attrs:{clearable:"",placeholder:"图表名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.crud.toQuery(t)}},model:{value:e.crud.entity.name,callback:function(t){e.$set(e.crud.entity,"name",t)},expression:"crud.entity.name"}}),e._v(" "),a("label",{staticClass:"el-form-item-label"},[e._v("图表编码")]),e._v(" "),a("el-input",{staticClass:"filter-item",staticStyle:{width:"185px"},attrs:{clearable:"",placeholder:"图表编码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.crud.toQuery(t)}},model:{value:e.crud.entity.code,callback:function(t){e.$set(e.crud.entity,"code",t)},expression:"crud.entity.code"}}),e._v(" "),a("rrOperation",{attrs:{crud:e.crud}})],1):e._e(),e._v(" "),a("crudOperation",{attrs:{permission:e.permission}})],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.crud.loading,expression:"crud.loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:e.crud.data,size:"small"},on:{"selection-change":e.crud.selectionChangeHandler}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"图表名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"code",label:"图表编码"}}),e._v(" "),a("el-table-column",{attrs:{prop:"cgrSql",label:"查询数据SQL"}}),e._v(" "),a("el-table-column",{attrs:{prop:"xaxisField",label:"x轴数据字段"}}),e._v(" "),a("el-table-column",{attrs:{prop:"yaxisText",label:"y轴文字描述"}}),e._v(" "),a("el-table-column",{directives:[{name:"has-permission",rawName:"v-has-permission",value:["graphReport:update","graphReport:delete"],expression:"['graphReport:update','graphReport:delete']"}],attrs:{label:"操作",width:"200px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("udOperation",{attrs:{data:t.row,permission:e.permission}},[a("el-button",{directives:[{name:"has-permission",rawName:"v-has-permission",value:e.permission.edit,expression:"permission.edit"}],attrs:{slot:"right",size:"mini",type:"primary",icon:"el-icon-s-tools"},on:{click:function(a){return e.testFunction(t.row.id)}},slot:"right"})],1)]}}])})],1),e._v(" "),a("pagination")],1)},o=[],i=a("bd86"),s=a("cebc"),n=a("3b7f"),c=a("c6db"),d=a("4f59"),p=a("ab00"),u=a("8414"),m=a("55b8"),f=a("d088"),b={name:"GraphReport",components:{eForm:f["default"],pagination:m["a"],crudOperation:p["a"],rrOperation:d["a"],udOperation:u["a"]},mixins:[Object(c["f"])(),Object(c["d"])(),Object(c["a"])()],cruds:function(){return Object(c["b"])({title:"图表配置",url:"support/report/graphReport/page",idField:"id",sort:"id,desc",crudMethod:Object(s["a"])({},n["a"])})},data:function(){return{permission:{add:["graphReport:create"],edit:["graphReport:update"],del:["graphReport:delete"]}}},methods:(l={},Object(i["a"])(l,c["b"].HOOK.beforeRefresh,function(){return!0}),Object(i["a"])(l,"testFunction",function(e){this.$router.push({path:"/report/graphReportChart",query:{id:e}})}),l)},h=b,v=a("0c7c"),g=Object(v["a"])(h,r,o,!1,null,"1550a046",null);t["default"]=g.exports},"3b7f":function(e,t,a){"use strict";a.d(t,"d",function(){return s}),a.d(t,"c",function(){return c}),a.d(t,"b",function(){return d});var l=a("9bd2");function r(e){return l["a"].postData("support/report/graphReport/create",e)}function o(e){return l["a"].deleteData("support/report/graphReport/delete",e)}function i(e){return l["a"].putData("support/report/graphReport/update",e)}function s(e){return l["a"].postData("support/report/graphReport/parseSql",e)}function n(e,t){return l["a"].download("support/report/graphReport/export",e,t)}function c(e){return l["a"].get("support/report/graphReport/getGraphReport/".concat(e))}function d(e){return l["a"].get("support/report/graphReport/getChartsData/".concat(e))}t["a"]={add:r,edit:i,del:o,download:n}},8414:function(e,t,a){"use strict";var l,r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{directives:[{name:"has-permission",rawName:"v-has-permission",value:e.permission.edit,expression:"permission.edit"}],attrs:{loading:2===e.crud.status.cu,disabled:e.disabledEdit,size:"mini",type:"primary",icon:"el-icon-edit"},on:{click:function(t){return e.crud.toEdit(e.data)}}}),e._v(" "),a("el-popover",{directives:[{name:"has-permission",rawName:"v-has-permission",value:e.permission.del,expression:"permission.del"}],attrs:{placement:"top",width:"180",trigger:"manual"},on:{show:e.onPopoverShow,hide:e.onPopoverHide},model:{value:e.pop,callback:function(t){e.pop=t},expression:"pop"}},[a("p",[e._v(e._s(e.msg))]),e._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:e.doCancel}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{loading:2===e.crud.dataStatus[e.crud.getDataId(e.data)].delete,type:"primary",size:"mini"},on:{click:function(t){return e.crud.doDelete(e.data)}}},[e._v("确定")])],1),e._v(" "),a("el-button",{attrs:{slot:"reference",disabled:e.disabledDle,type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:e.toDelete},slot:"reference"})],1),e._v(" "),e._t("right")],2)},o=[],i=a("bd86"),s=a("c6db"),n={mixins:[Object(s["a"])()],props:{data:{type:Object,required:!0},permission:{type:Object,required:!0},disabledEdit:{type:Boolean,default:!1},disabledDle:{type:Boolean,default:!1},msg:{type:String,default:"确定删除本条数据吗？"}},data:function(){return{pop:!1}},methods:(l={doCancel:function(){this.pop=!1,this.crud.cancelDelete(this.data)},toDelete:function(){this.pop=!0}},Object(i["a"])(l,s["b"].HOOK.afterDelete,function(e,t){t===this.data&&(this.pop=!1)}),Object(i["a"])(l,"onPopoverShow",function(){var e=this;setTimeout(function(){document.addEventListener("click",e.handleDocumentClick)},0)}),Object(i["a"])(l,"onPopoverHide",function(){document.removeEventListener("click",this.handleDocumentClick)}),Object(i["a"])(l,"handleDocumentClick",function(e){this.pop=!1}),l)},c=n,d=a("0c7c"),p=Object(d["a"])(c,r,o,!1,null,null,null);t["a"]=p.exports},d088:function(e,t,a){"use strict";a.r(t);var l,r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{"close-on-click-modal":!1,"append-to-body":!0,visible:e.crud.status.cu>0,title:e.crud.status.title,"before-close":e.crud.cancelCU,fullscreen:!0,width:"80%",top:"8vh"},on:{"update:visible":function(t){return e.$set(e.crud.status,"cu > 0",t)}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}],ref:"form",attrs:{model:e.form,rules:e.rules,size:"small","label-width":"110px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.crud.submitCU(t)}}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{xs:24,sm:12,md:8,lg:6}},[a("el-form-item",{attrs:{label:"图表名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"图表名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{xs:24,sm:12,md:8,lg:6}},[a("el-form-item",{attrs:{label:"编码",prop:"code"}},[a("el-input",{attrs:{placeholder:"编码"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1)],1),e._v(" "),a("el-col",{attrs:{xs:24,sm:12,md:8,lg:6}},[a("el-form-item",{attrs:{label:"展示模板",prop:"displayTemplate"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择展示模板",clearable:""},model:{value:e.form.displayTemplate,callback:function(t){e.$set(e.form,"displayTemplate",t)},expression:"form.displayTemplate"}},[a("el-option",{key:"1",attrs:{label:"Tab风格",value:"tab"}}),e._v(" "),a("el-option",{key:"2",attrs:{label:"单排布局",value:"single"}}),e._v(" "),a("el-option",{key:"3",attrs:{label:"双排布局",value:"double"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{xs:24,sm:12,md:8,lg:6}},[a("el-form-item",{attrs:{label:"X轴字段",prop:"xaxisField"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"X轴字段",clearable:""},model:{value:e.form.xaxisField,callback:function(t){e.$set(e.form,"xaxisField",t)},expression:"form.xaxisField"}},e._l(e.sqlColumns,function(e){return a("el-option",{key:e.columnName,attrs:{label:e.columnName,value:e.columnName}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{xs:24,sm:12,md:8,lg:6}},[a("el-form-item",{attrs:{label:"Y轴字段",prop:"yaxisField"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"","allow-create":"",filterable:"","default-first-option":"",placeholder:"Y轴字段"},model:{value:e.form.yaxisField,callback:function(t){e.$set(e.form,"yaxisField",t)},expression:"form.yaxisField"}},e._l(e.sqlColumns,function(e){return a("el-option",{key:e.columnName,attrs:{label:e.columnName,value:e.columnName}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{xs:24,sm:12,md:8,lg:6}},[a("el-form-item",{attrs:{label:"数据类型",prop:"dataType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择数据类型",clearable:""},model:{value:e.form.dataType,callback:function(t){e.$set(e.form,"dataType",t)},expression:"form.dataType"}},[a("el-option",{key:"1",attrs:{label:"SQL",value:"SQL"}}),e._v(" "),a("el-option",{key:"2",attrs:{label:"JSON",value:"JSON"}})],1)],1)],1),e._v(" "),"SQL"===e.crud.form.dataType?a("el-col",{attrs:{xs:24,sm:12,md:8,lg:6}},[a("el-form-item",{attrs:{label:"数据源",prop:"dataType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"数据源",clearable:""},model:{value:e.form.dsId,callback:function(t){e.$set(e.form,"dsId",t)},expression:"form.dsId"}},e._l(e.dict.DATA_SOURCE,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.value}})}),1)],1)],1):e._e(),e._v(" "),a("el-col",{attrs:{xs:24,sm:12,md:16,lg:6}},[a("el-form-item",{attrs:{label:"图表类型",prop:"chartType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择图表类型",clearable:"",multiple:""},model:{value:e.form.graphType,callback:function(t){e.$set(e.form,"graphType",t)},expression:"form.graphType"}},[a("el-option",{key:"1",attrs:{label:"柱状图",value:"bar"}}),e._v(" "),a("el-option",{key:"2",attrs:{label:"曲线图",value:"line"}}),e._v(" "),a("el-option",{key:"3",attrs:{label:"饼图",value:"pie"}}),e._v(" "),a("el-option",{key:"4",attrs:{label:"数据列表",value:"table"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{xs:24,sm:24,md:24,lg:24}},[a("el-form-item",{attrs:{label:"描述",prop:"content"}},[a("el-input",{attrs:{placeholder:"描述"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1)],1),e._v(" "),"SQL"===e.form.dataType?a("el-col",{attrs:{xs:24,sm:24,md:24,lg:24}},[a("el-form-item",{attrs:{label:"查询SQL",prop:"cgrSql"}},[a("code-edit",{attrs:{height:"200",codeType:"text/x-mysql"},model:{value:e.form.cgrSql,callback:function(t){e.$set(e.form,"cgrSql",t)},expression:"form.cgrSql"}}),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-info"},on:{click:e.parseSql}},[e._v("解析SQL")])],1)],1):a("el-col",{attrs:{xs:24,sm:24,md:24,lg:24}},[a("el-form-item",{attrs:{label:"数据JSON",prop:"json"}},[a("code-edit",{attrs:{height:"200"},model:{value:e.form.json,callback:function(t){e.$set(e.form,"json",t)},expression:"form.json"}})],1)],1)],1)],1),e._v(" "),a("el-tabs",[a("el-tab-pane",{attrs:{label:"列表字段"}},[a("div",{staticClass:"button-row"},[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.add}},[e._v("新增")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.dataListSelections.length>0,expression:"dataListSelections.length > 0"}],attrs:{size:"small",type:"primary",icon:"el-icon-minus"},on:{click:e.del}},[e._v("删除")])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dataListLoading,expression:"dataListLoading"}],staticStyle:{width:"100%"},attrs:{data:e.form.graphReportItemList,border:"","row-class-name":e.tableRowClassName},on:{"selection-change":e.dataListSelectionChangeHandle}},[a("el-table-column",{attrs:{type:"selection","header-align":"center",align:"center",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{type:"index","header-align":"center",align:"center",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"fieldName","header-align":"center",align:"center",label:"字段名"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"small",placeholder:"字段名"},model:{value:t.row.fieldName,callback:function(a){e.$set(t.row,"fieldName",a)},expression:"scope.row.fieldName"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"fieldTxt","header-align":"center",align:"center",label:"字段文本"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"small",placeholder:"字段文本"},model:{value:t.row.fieldTxt,callback:function(a){e.$set(t.row,"fieldTxt",a)},expression:"scope.row.fieldTxt"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"orderNum","header-align":"center",align:"center",label:"排序"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"small",type:"number",placeholder:"排序"},model:{value:t.row.orderNum,callback:function(a){e.$set(t.row,"orderNum",a)},expression:"scope.row.orderNum"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"fieldType","header-align":"center",align:"center",label:"字段类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{attrs:{size:"small",placeholder:"请选择",clearable:""},model:{value:t.row.fieldType,callback:function(a){e.$set(t.row,"fieldType",a)},expression:"scope.row.fieldType"}},[a("el-option",{key:"1",attrs:{label:"数值类型",value:"1"}}),e._v(" "),a("el-option",{key:"2",attrs:{label:"日期类型",value:"2"}}),e._v(" "),a("el-option",{key:"3",attrs:{label:"字符类型",value:"3"}}),e._v(" "),a("el-option",{key:"4",attrs:{label:"长整型",value:"4"}})],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"isShow","header-align":"center",align:"center",label:"是否显示"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{"true-label":"Y","false-label":"N",size:"small"},model:{value:t.row.isShow,callback:function(a){e.$set(t.row,"isShow",a)},expression:"scope.row.isShow"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"isTotal","header-align":"center",align:"center",label:"计算总计"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{"true-label":"Y","false-label":"N",size:"small"},model:{value:t.row.isTotal,callback:function(a){e.$set(t.row,"isTotal",a)},expression:"scope.row.isTotal"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"searchFlag","header-align":"center",align:"center",label:"是否查询"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{"true-label":"Y","false-label":"N",size:"small"},model:{value:t.row.searchFlag,callback:function(a){e.$set(t.row,"searchFlag",a)},expression:"scope.row.searchFlag"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"queryMode","header-align":"center",align:"center",label:"查询模式"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{attrs:{size:"small",placeholder:"请选择",clearable:""},model:{value:t.row.searchType,callback:function(a){e.$set(t.row,"searchType",a)},expression:"scope.row.searchType"}},[a("el-option",{key:"1",attrs:{label:"单条件查询",value:"1"}}),e._v(" "),a("el-option",{key:"2",attrs:{label:"范围查询",value:"2"}})],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"dictCode","header-align":"center",align:"center",label:"字典Code"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"small",placeholder:"字典Code"},model:{value:t.row.dictCode,callback:function(a){e.$set(t.row,"dictCode",a)},expression:"scope.row.dictCode"}})]}}])})],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.crud.cancelCU}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.crud.submitCU}},[e._v("确定")])],1)],1)},o=[],i=a("bd86"),s=(a("ac6a"),a("f3e2"),a("28a5"),a("3b7f")),n=a("720f"),c=a("c6db"),d={id:0,name:"",code:"",xaxisField:"",yaxisField:[],yaxisText:"yaxis_text",displayTemplate:"tab",dataType:"SQL",graphType:["bar"],content:"",cgrSql:"",json:"",dsId:"",graphReportItemList:[{fieldName:"",fieldTxt:"",orderNum:1,fieldType:"",isShow:"Y",isTotal:"N",searchFlag:"N",dictCode:""}]},p={components:{CodeEdit:n["a"]},mixins:[Object(c["c"])(d)],dicts:["DATA_SOURCE"],data:function(){return{dialog:!1,formLoading:!1,rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],code:[{required:!0,message:"请输入编码",trigger:"blur"}],xaxisField:[{required:!0,message:"请输入X轴字段",trigger:"blur"}],yaxisField:[{required:!0,message:"请输入Y轴字段",trigger:"blur"}],dsId:[{required:!0,message:"请选择数据源",trigger:"blur"}]},dataList:[{fieldName:"",fieldTxt:"",orderNum:1,fieldType:"",isShow:"Y",isTotal:"N",searchFlag:"N",dictCode:""}],sqlColumns:[],dataListLoading:!1,dataListSelections:[]}},created:function(){},methods:(l={},Object(i["a"])(l,c["b"].HOOK.beforeToEdit,function(e,t){var a=this;return t.yaxisField&&(t.yaxisField=t.yaxisField.split(",")),t.graphType&&(t.graphType=t.graphType.split(",")),t.id&&(this.formLoading=!0,Object(s["c"])(t.id).then(function(e){a.formLoading=!1,e?t.graphReportItemList=e.data.graphReportItemList:a.$message.error(e.msg)}).catch(function(e){a.formLoading=!1,console.log(e)})),!0}),Object(i["a"])(l,"parseSql",function(){var e=this;this.$isEmpty(this.form.dsId)?this.$notify({title:"请先选择数据源",type:"warning",duration:2500}):this.$isEmpty(this.form.cgrSql)?this.$notify({title:"请输入SQL语句",type:"warning",duration:2500}):Object(s["d"])({dsId:this.form.dsId,cgrSql:this.form.cgrSql}).then(function(t){var a=t.data;e.form.graphReportItemList.splice(0,e.form.graphReportItemList.length),a.forEach(function(t){e.sqlColumns.push(t),e.form.graphReportItemList.push({fieldName:t.columnName,fieldTxt:t.columnName,orderNum:1,fieldType:t.columnClassName,isShow:"Y",isTotal:"N",searchFlag:"N",dictCode:""})}),e.$notify({title:"解析完成!",type:"success",duration:2500})})}),Object(i["a"])(l,"add",function(){this.form.graphReportItemList.push({fieldName:"",fieldTxt:"",orderNum:1,fieldType:"",isShow:"Y",isTotal:"N",searchFlag:"N",dictCode:""})}),Object(i["a"])(l,"tableRowClassName",function(e,t){e.row.index=e.rowIndex}),Object(i["a"])(l,"dataListSelectionChangeHandle",function(e){this.dataListSelections=e}),Object(i["a"])(l,"del",function(){var e=this,t=this.dataListSelections;t&&t.forEach(function(t,a){e.form.graphReportItemList.forEach(function(a,l){t.index===a.index&&e.form.graphReportItemList.splice(l,1)})})}),l)},u=p,m=a("0c7c"),f=Object(m["a"])(u,r,o,!1,null,null,null);t["default"]=f.exports}}]);